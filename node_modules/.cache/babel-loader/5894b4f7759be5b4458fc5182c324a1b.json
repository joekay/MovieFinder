{"ast":null,"code":"var _jsxFileName = \"/Users/joakimkonac/Documents/Skolprojekt/awebb/src/Main.js\";\nimport React from 'react';\nimport Header from './Header';\nimport MovieList from './MovieList';\nimport Api from './Api';\nimport './css/App.css';\nimport firebase from 'firebase';\nimport { connect } from 'react-redux';\nimport store from '../reducers/store';\nconst config = {\n  apiKey: \"AIzaSyA1d9vZltW10aoImVaEWBPV5H8pFho2wDg\",\n  authDomain: \"awebb-efe92.firebaseapp.com\",\n  databaseURL: \"https://awebb-efe92.firebaseio.com\",\n  projectId: \"awebb-efe92\",\n  storageBucket: \"awebb-efe92.appspot.com\",\n  messagingSenderId: \"878717963187\"\n};\nfirebase.initializeApp(config);\nconst auth = firebase.auth;\nconst provider = new firebase.auth.FacebookAuthProvider();\nvar counter = 0;\nvar favItems = [];\nvar synced = [];\nvar datalist = [];\nprovider.setCustomParameters({\n  'display': 'popup'\n});\n\nclass Main extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.logout = () => {\n      counter = 0;\n      firebase.auth().signOut().then(() => {\n        this.setState({\n          user: null,\n          isLoggedin: false\n        });\n      });\n    };\n\n    this.onSearchbarChange = event => {\n      this.setState({\n        searchbarInput: event.target.value\n      });\n      console.log(this.state.user);\n    };\n\n    this.addFavorite = movie => {\n      if (movie.isFavorite) {\n        this.removeFavorite(movie);\n        return;\n      }\n\n      var user = firebase.auth().currentUser;\n      var userData = this.state.user.uid;\n      var items = this.state.items.slice();\n      items[items.indexOf(movie)].isFavorite = true;\n      this.setState({\n        item: items\n      });\n      var selectedMovie = items[items.indexOf(movie)];\n      var selectedMovieId = selectedMovie.id;\n\n      if (counter != 0) {\n        var key = firebase.database().ref('users/' + user.uid).push().key;\n        firebase.database().ref('users/' + user.uid).update({\n          [selectedMovieId]: selectedMovie\n        });\n      }\n\n      console.log(\"movie id: \" + items[items.indexOf(movie)].id);\n      console.log(\"currentUser: \" + user.uid);\n    };\n\n    this.removeFavorite = movie => {\n      var items = this.state.items.slice();\n      items[items.indexOf(movie)].isFavorite = false;\n      this.setState({\n        item: items\n      });\n      var user = firebase.auth().currentUser;\n      var userData = this.state.user.uid;\n      var selectedMovie = items[items.indexOf(movie)];\n      var selectedMovieId = selectedMovie.id;\n      firebase.database().ref('users/' + user.uid + '/' + selectedMovieId).set(null);\n    };\n\n    this.state = {\n      items: [],\n      favoriteItems: [],\n      syncedItems: [],\n      searchbarInput: '',\n      favorites: [],\n      comment: 0,\n      user: null,\n      isLoggedin: false,\n      isSynced: false\n    };\n    store.subscribe(() => {\n      // When state will be updated(in our case, when items will be fetched), \n      // we will update local component state and force component to rerender \n      // with new data.\n      this.setState({});\n    });\n    this.renderChoices = this.renderChoices.bind(this);\n  }\n\n  async fbLogin() {\n    auth().signInWithPopup(provider).then(({\n      user\n    }) => {\n      this.setState({\n        user,\n        isLoggedin: true,\n        counter: 1\n      });\n    });\n  }\n\n  async login() {\n    const test = await auth().signInWithPopup(provider).then(({\n      user\n    }) => {\n      this.setState(prevState => ({\n        user,\n        isLoggedin: true,\n        counter: 1,\n        favKey: 1\n      }), this.renderChoices);\n    });\n    const theFavs = this.state.syncedItems.map(l => Object.assign({}, l));\n    console.log(datalist);\n    console.log(this.state.syncedItems); //this.setState(prevState => ({ syncedItems }));\n\n    console.log(this.props);\n    counter++;\n    this.props.dispatch({\n      type: \"SYNC\",\n      favo: datalist\n    });\n  }\n\n  // Last step of initialization (Component lifecycle)\n  componentDidMount() {\n    Api.getList().then(result => {\n      this.setState(prevState => ({\n        items: result.results\n      }));\n    });\n    console.log(this.state.items); //Hämta favoriter här? Tvinga login i början\n\n    {\n      /*auth.onAuthStateChanged().then(user => {\n      if (user) {\n       this.setState({ user })\n      };\n      provider.getInstance().signOut();\n      })*/\n    }\n  }\n\n  componentDidUpdate() {\n    console.log(this.props.favo);\n    console.log(this.state.isLoggedin + \" \" + this.state.isSynced);\n\n    if (this.state.isLoggedin == true && this.state.isSynced == false) {\n      this.setState({\n        isSynced: true\n      });\n      this.state.isSynced = true;\n      let a = this.state.items.slice(); //creates the clone of the state\n\n      let b = datalist.slice();\n      this.setState({\n        items: a.concat(b)\n      });\n    }\n  } // Changes state depending on searchbar input\n\n\n  async renderChoices() {\n    var user = firebase.auth().currentUser.uid;\n    var childData2 = this.state.syncedItems.slice();\n    var query = firebase.database().ref(\"users/\" + user + \"/\").orderByKey();\n    query.once(\"value\").then(function (snapshot) {\n      snapshot.forEach(function (childSnapshot) {\n        // key will be \"ada\" the first time and \"alan\" the second time\n        var key = childSnapshot.key; // childData will be the actual contents of the child\n\n        var childData = childSnapshot.val();\n        /*this.setState({\n          items: [...this.state.items, childData]\n        })*/\n        // Add item to it\n\n        datalist.push(childData);\n      });\n    }.bind(this));\n    counter++;\n    console.log(\"tjena\");\n    console.log(datalist);\n    favItems = datalist;\n    console.log(favItems);\n    this.props.dispatch({\n      type: \"SYNC\",\n      favo: datalist\n    });\n  } // Add favorites\n\n\n  render() {\n    // Filter items depending on searchbar input\n    const filteredItems = this.state.items.filter(item => {\n      return item.title.toLowerCase().indexOf(this.state.searchbarInput) >= 0;\n    });\n    console.log(this.state.isLoggedin + \" \" + counter);\n\n    if (this.state.isLoggedin && counter == 4) {\n      this.renderChoices();\n      console.log(\"HÄNDER JAG\");\n      console.log(datalist);\n      let b = datalist.slice();\n      favItems = datalist; // Items that are favorites\n\n      favItems = this.state.items.filter(item => {\n        if (item.isFavorite) return true;else return false;\n      });\n      console.log(favItems);\n    } else {\n      favItems = this.state.items.filter(item => {\n        if (item.isFavorite) {\n          console.log(item);\n          return true;\n        } else return false;\n      });\n      console.log(favItems);\n    }\n\n    return React.createElement(\"div\", {\n      className: \"container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 279\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"app\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 281\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      style: {\n        display: 'flex',\n        alignItems: 'baseline',\n        justifyContent: 'center',\n        flexWrap: 'wrap',\n        flexDirection: 'row',\n        marginTop: '20px',\n        marginBottom: '20px'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 282\n      },\n      __self: this\n    }, React.createElement(Header, {\n      onSearchbarChange: this.onSearchbarChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 283\n      },\n      __self: this\n    }), React.createElement(\"p\", {\n      style: {\n        color: 'white',\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        marginRight: '10px'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 285\n      },\n      __self: this\n    }, this.state.user ? \"Signed in as \".concat(this.state.user.displayName, \"!\") : 'Please log in to add favorites.'), console.log(favItems), React.createElement(\"button\", {\n      style: {\n        width: '180px'\n      },\n      onClick: () => {\n        if (this.state.user == null) {\n          this.login();\n        } else {\n          this.logout();\n        }\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 292\n      },\n      __self: this\n    }, this.state.user == null ? \"Log In with Facebook\" : \"Log Out\"))), React.createElement(MovieList, {\n      items: filteredItems,\n      onStarClick: movie => this.addFavorite(movie),\n      user: this.state.user,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 305\n      },\n      __self: this\n    }, React.createElement(\"h1\", {\n      style: {\n        color: \"white\",\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 306\n      },\n      __self: this\n    }, this.state.user ? \"Favorites\" : null), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 307\n      },\n      __self: this\n    }, this.props.user ? React.createElement(MovieList, {\n      items: datalist,\n      onStarClick: movie => this.removeFavorite(movie),\n      user: this.state.user,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 309\n      },\n      __self: this\n    }) : null)));\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    favo: state.favo\n  };\n};\n\nexport default connect(mapStateToProps)(Main);","map":{"version":3,"sources":["/Users/joakimkonac/Documents/Skolprojekt/awebb/src/Main.js"],"names":["React","Header","MovieList","Api","firebase","connect","store","config","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","initializeApp","auth","provider","FacebookAuthProvider","counter","favItems","synced","datalist","setCustomParameters","Main","Component","constructor","props","logout","signOut","then","setState","user","isLoggedin","onSearchbarChange","event","searchbarInput","target","value","console","log","state","addFavorite","movie","isFavorite","removeFavorite","currentUser","userData","uid","items","slice","indexOf","item","selectedMovie","selectedMovieId","id","key","database","ref","push","update","set","favoriteItems","syncedItems","favorites","comment","isSynced","subscribe","renderChoices","bind","fbLogin","signInWithPopup","login","test","prevState","favKey","theFavs","map","l","Object","assign","dispatch","type","favo","componentDidMount","getList","result","results","componentDidUpdate","a","b","concat","childData2","query","orderByKey","once","snapshot","forEach","childSnapshot","childData","val","render","filteredItems","filter","title","toLowerCase","display","alignItems","justifyContent","flexWrap","flexDirection","marginTop","marginBottom","color","marginRight","displayName","width","mapStateToProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Header from './Header';\nimport MovieList from './MovieList';\nimport Api from './Api';\nimport './css/App.css';\nimport firebase from 'firebase';\nimport { connect } from 'react-redux';\nimport store from '../reducers/store';\n\nconst config = {\n  apiKey: \"AIzaSyA1d9vZltW10aoImVaEWBPV5H8pFho2wDg\",\n  authDomain: \"awebb-efe92.firebaseapp.com\",\n  databaseURL: \"https://awebb-efe92.firebaseio.com\",\n  projectId: \"awebb-efe92\",\n  storageBucket: \"awebb-efe92.appspot.com\",\n  messagingSenderId: \"878717963187\"\n}\n\nfirebase.initializeApp(config)\nconst auth = firebase.auth\n\n\nconst provider = new firebase.auth.FacebookAuthProvider();\n\nvar counter = 0;\nvar favItems = [];\nvar synced = [];\nvar datalist = [];\n\nprovider.setCustomParameters({\n  'display': 'popup'\n});\n\ntype State = {\n  items: Array<Item>,\n  searchbarInput: string,\n};\n\nclass Main extends React.Component {\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n    items: [],\n    favoriteItems: [],\n    syncedItems: [],\n    searchbarInput: '',\n    favorites: [],\n    comment: 0,\n    user: null,\n    isLoggedin: false,\n    isSynced: false,\n\n\n    }\n\n    store.subscribe(() => {\n      // When state will be updated(in our case, when items will be fetched), \n      // we will update local component state and force component to rerender \n      // with new data.\n\n      this.setState({\n        \n      });\n    });\n\n    this.renderChoices = this.renderChoices.bind(this);\n}\n\nasync fbLogin(){\n    auth().signInWithPopup(provider)\n    .then(({ user }) => {\n      this.setState({ user, isLoggedin: true, counter:1 })\n    })\n}\n\n  async login() {\n\n    const test =  await auth().signInWithPopup(provider)\n\n    .then(({ user }) => {\n      this.setState(prevState => ({ user, isLoggedin: true, counter: 1, favKey: 1 }),\n       this.renderChoices)\n    })\n\n    const theFavs = this.state.syncedItems.map(l => Object.assign({}, l));\n    \n    console.log(datalist);\n    console.log(this.state.syncedItems);\n    //this.setState(prevState => ({ syncedItems }));\n    console.log(this.props);\n\n    counter++;\n\n this.props.dispatch({ type: \"SYNC\", favo: datalist});\n\n  }\n\n  logout = () => {\n    counter = 0;\n    firebase.auth().signOut().then(() => {\n      this.setState({ user: null, isLoggedin: false }) \n    })\n  }\n\n  // Last step of initialization (Component lifecycle)\n  componentDidMount() {\n    Api.getList().then((result: ApiResponse) => {\n      this.setState((prevState: State) => ({\n        items: result.results,\n      }))\n    });\n\n    console.log(this.state.items);\n\n\n\n    //Hämta favoriter här? Tvinga login i början\n\n    {/*auth.onAuthStateChanged().then(user => {\n    if (user) {\n      this.setState({ user })\n    };\n    provider.getInstance().signOut();\n  })*/}\n  }\n\n  componentDidUpdate() {\n  console.log(this.props.favo);\n    console.log(this.state.isLoggedin + \" \" + this.state.isSynced);\n  if (this.state.isLoggedin == true && this.state.isSynced == false) {\n    this.setState({isSynced: true});\n    this.state.isSynced = true;\n\n\n    let a = this.state.items.slice(); //creates the clone of the state\n    let b = datalist.slice();\n    this.setState({items: a.concat(b)});\n  }\n\n\n  }\n\n  // Changes state depending on searchbar input\n  onSearchbarChange = (event: Object) => {\n    this.setState({ searchbarInput: event.target.value });\n    console.log(this.state.user);\n  }\n\n  async renderChoices () {\n\n    var user = firebase.auth().currentUser.uid;\n    var childData2 = this.state.syncedItems.slice();\n    var query = firebase.database().ref(\"users/\" + user + \"/\").orderByKey();\n    query.once(\"value\")\n    .then(function(snapshot) {\n      \n      snapshot.forEach(function(childSnapshot) {\n          // key will be \"ada\" the first time and \"alan\" the second time\n          var key = childSnapshot.key;\n          // childData will be the actual contents of the child\n          var childData = childSnapshot.val();\n\n          /*this.setState({\n            items: [...this.state.items, childData]\n          })*/\n\n          // Add item to it\n          datalist.push(childData);\n\n        });\n\n    }.bind(this));\n\n    counter++;\n    console.log(\"tjena\");\n    console.log(datalist);\n    favItems = datalist;\n    console.log(favItems);\n\n  this.props.dispatch({ type: \"SYNC\", favo: datalist});\n\n  }\n\n// Add favorites\naddFavorite = (movie) => {\n  if(movie.isFavorite){\n    this.removeFavorite(movie);\n    return;\n  }\n  var user = firebase.auth().currentUser;\n  var userData = this.state.user.uid;\n\n  var items = this.state.items.slice();\n  items[items.indexOf(movie)].isFavorite = true;\n  this.setState({\n    item: items\n  })\n\n  var selectedMovie = items[items.indexOf(movie)];\n  var selectedMovieId = selectedMovie.id;\n\n  if(counter!=0){\n  var key = firebase.database().ref('users/' + user.uid).push().key;\n  firebase.database().ref('users/' + user.uid).update({[selectedMovieId]: selectedMovie});\n  }\n\n  console.log(\"movie id: \" + items[items.indexOf(movie)].id);\n  console.log(\"currentUser: \" + user.uid);\n}\n\n  // Remove favorites\n  removeFavorite = (movie) => {\n    var items = this.state.items.slice();\n    items[items.indexOf(movie)].isFavorite = false;\n    this.setState({\n      item: items\n    })\n\n\n\n    var user = firebase.auth().currentUser;\n    var userData = this.state.user.uid;\n    var selectedMovie = items[items.indexOf(movie)];\n    var selectedMovieId = selectedMovie.id;\n\n    firebase.database().ref('users/' + user.uid + '/' + selectedMovieId).set(null);\n\n  }\n\n\n\n  render () {\n\n    // Filter items depending on searchbar input\n    const filteredItems = this.state.items.filter(item => {\n      return item.title.toLowerCase().indexOf(this.state.searchbarInput) >= 0;\n    });\n\n    console.log(this.state.isLoggedin + \" \" + counter);\n\n    if(this.state.isLoggedin && counter == 4){\n\n      this.renderChoices();\n      \n      console.log(\"HÄNDER JAG\");\n      console.log(datalist);\n          let b = datalist.slice();\n    favItems = datalist;\n\n\n    // Items that are favorites\n    favItems = this.state.items.filter(item => {\n      if(item.isFavorite)\n        return true;\n      else\n        return false;\n    })\n    console.log(favItems);\n\n\n    } else{\n    favItems = this.state.items.filter(item => {\n      if(item.isFavorite){\n        console.log(item);\n        return true;\n      }\n      else\n        return false;\n    })\n    console.log(favItems);\n    }\n\n    \n\n    return (\n\n      <div className=\"container\">\n\n      <div className='app'>\n      <div style={{display: 'flex', alignItems:'baseline', justifyContent: 'center', flexWrap: 'wrap', flexDirection: 'row', marginTop: '20px', marginBottom: '20px'}}>\n      <Header onSearchbarChange={this.onSearchbarChange}/>\n\n      <p style={{color: 'white',display: 'flex',  justifyContent:'center', alignItems:'center', marginRight: '10px'}}>\n      {this.state.user ? `Signed in as ${this.state.user.displayName}!` : 'Please log in to add favorites.'}\n      </p>\n\n      {console.log(favItems)}\n\n\n      <button style={{width: '180px'}} onClick={()=>{ if(this.state.user == null){ this.login()} else {this.logout()} }}>\n      {this.state.user==null ? \"Log In with Facebook\" : \"Log Out\"}\n      </button>\n\n      </div>\n      </div>\n\n      <MovieList \n      items={filteredItems} \n      onStarClick={(movie)=>this.addFavorite(movie)}\n      user={this.state.user}\n      />\n\n      <div>\n      <h1 style={{color: \"white\", display: 'flex',  justifyContent:'center', alignItems:'center'}}>{this.state.user ? `Favorites` : null}</h1>\n      <div>\n      {this.props.user ? \n        <MovieList \n        items={datalist} \n        onStarClick={(movie)=>this.removeFavorite(movie)} \n        user={this.state.user}\n        />   : null}\n      \n      </div>\n      </div>\n\n      </div>\n\n      )\n\n\n\n    }\n\n  }\n\nconst mapStateToProps = state => {\n\nreturn{\n    favo: state.favo\n  }\n};\n\n  export default connect(mapStateToProps)(Main);\n"]},"metadata":{},"sourceType":"module"}